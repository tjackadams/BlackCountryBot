trigger:
- master

pool:
    vmImage: 'windows-latest'

variables:
    solution: '**/*.sln'
    buildPlatform: 'Any CPU'
    buildConfiguration: 'Release'
    DOTNET_CLI_TELEMETRY_OPTOUT: '1'

steps:
- task: DotNetCoreInstaller@1
  displayName: 'Use .Net Core sdk '
  inputs:
    useGlobalJson: true

- task: DotNetCoreCLI@2
  displayName: Restore
  inputs:
    command: restore
    configuration: '$(buildConfiguration)'

- task: DotNetCoreCLI@2
  displayName: Build
  inputs:
    configuration: '$(buildConfiguration)'
    buildProperties: '$(buildPlatform)'

- task: DotNetCoreCLI@2
  displayName: 'dotnet test'
  inputs:
    command: test
    projects: '**/*[Tt]est/**/*.csproj'
    configuration: '$(buildConfiguration)'
    arguments: '/p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput=$(Build.SourcesDirectory)\TestResults\Coverage\ /p:Exclude="[xunit*]*"'

